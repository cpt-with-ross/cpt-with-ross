<%= form_with model: Message.new,
              url: chat_messages_path(chat),
              id: "chat-form",
              html: { autocomplete: "off" },
              data: { controller: "chat-form", action: "turbo:submit-start->chat-form#disable turbo:submit-end->chat-form#reset" } do |f| %>
  <%# Pass focus context to the AI so it knows what the user is currently viewing %>
  <% if focus_context.present? %>
    <%= hidden_field_tag 'focus_context[type]', focus_context[:type] %>
    <%= hidden_field_tag 'focus_context[id]', focus_context[:id] %>
  <% end %>

  <div class="position-relative border rounded-3 p-2 shadow-sm" style="min-height: 120px;">
    <%= f.text_area :content,
        class: "form-control border-0 shadow-none w-100 h-100 bg-transparent",
        style: "resize: none;",
        placeholder: "Ask Ross about your thoughts, feelings, or worksheet...",
        rows: 3,
        data: { chat_form_target: "input", action: "keydown->chat-form#submitOnEnter" } %>

    <div class="d-flex justify-content-between align-items-end mt-2 px-1">
      <%= link_to clear_chat_path(chat),
                  data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to clear all messages?" },
                  class: "btn btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center p-0",
                  style: "width: 32px; height: 32px;",
                  title: "Clear chat" do %>
        <i class="fa-solid fa-trash-can small"></i>
      <% end %>
      <button class="btn btn-dark rounded-circle d-flex align-items-center justify-content-center p-0"
              type="submit"
              style="width: 32px; height: 32px;"
              data-chat-form-target="submit"
              title="Send message">
        <i class="fa-solid fa-paper-plane small"></i>
      </button>
    </div>
  </div>
<% end %>
