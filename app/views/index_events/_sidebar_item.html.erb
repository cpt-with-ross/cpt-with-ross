<% expanded = local_assigns.fetch(:expanded, false) %>
<div class="accordion-item bg-transparent border-0" id="<%= dom_id(index_event) %>">

  <div class="accordion-header d-flex align-items-center justify-content-between pe-2 sidebar-item-group" id="heading_<%= index_event.id %>">

    <%= render 'index_events/title_button', index_event: index_event, is_active: is_active, expanded: expanded %>

    <%= render 'shared/action_dropdown',
        item: index_event,
        edit_path: edit_index_event_path(index_event),
        delete_path: index_event_path(index_event),
        document_actions: document_actions(
          export_path: export_index_event_baseline_path(index_event),
          share_path: share_index_event_baseline_path(index_event)
        ) %>
  </div>

  <div id="collapse_<%= index_event.id %>" class="accordion-collapse collapse <%= 'show' if expanded %>" data-bs-parent="#indexEventsAccordion">
    <div class="accordion-body p-0 ms-3 border-start ps-3 py-2">

      <div class="d-flex justify-content-between align-items-center mb-1 pe-2 sidebar-item-group">
        <small class="text-uppercase fw-bold text-muted" style="font-size: 0.75rem; letter-spacing: 0.5px;">
          Stuck Points
        </small>

        <%= link_to new_index_event_stuck_point_path(index_event),
            class: "btn btn-sm btn-link text-muted p-0 action-btn",
            style: "font-size: 0.8rem;",
            title: "Add New Stuck Point",
            data: { turbo_frame: "new_stuck_point_frame_#{index_event.id}" } do %>
          <i class="fa-solid fa-plus"></i>
        <% end %>
      </div>

      <%= turbo_frame_tag "new_stuck_point_frame_#{index_event.id}" %>

      <div id="stuck_points_list_<%= index_event.id %>" class="accordion accordion-flush">
        <% index_event.stuck_points.each do |stuck_point| %>
          <%= render "stuck_points/sidebar_item", stuck_point: stuck_point %>
        <% end %>
      </div>

    </div>
  </div>
</div>
