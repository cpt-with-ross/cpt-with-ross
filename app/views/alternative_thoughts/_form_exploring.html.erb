<%= render "shared/stuck_point_context", stuck_point: @stuck_point %>

<%= simple_form_for @alternative_thought, data: { turbo_frame: "main_content" } do |f| %>
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-secondary text-white py-2">
      <h5 class="mb-0">Initial Belief</h5>
    </div>
    <div class="card-body">
      <p class="text-muted small mb-3">
        Before examining this stuck point, rate how much you currently believe it.
      </p>

      <div class="mb-0">
        <label class="form-label">How much do you believe this stuck point? (0-100%)</label>
        <div class="d-flex align-items-center gap-3">
          <input type="range"
                 name="alternative_thought[stuck_point_belief_before]"
                 id="alternative_thought_stuck_point_belief_before"
                 min="0" max="100"
                 value="<%= @alternative_thought.stuck_point_belief_before || 0 %>"
                 class="form-range flex-grow-1"
                 autocomplete="off"
                 data-controller="emotion-slider"
                 data-emotion-slider-target="slider"
                 data-action="input->emotion-slider#updateBadge">
          <span class="badge bg-primary" style="min-width: 48px;"
                data-emotion-slider-target="badge">
            <%= @alternative_thought.stuck_point_belief_before || 0 %>
          </span>
          <span>%</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-secondary text-white py-2">
      <h5 class="mb-0">Initial Emotions</h5>
    </div>
    <div class="card-body">
      <p class="text-muted small mb-4">
        Before examining this stuck point, rate how strongly you feel each emotion from 0 to 10.
      </p>

      <div class="row">
        <% AlternativeThought::EMOTIONS.each do |emotion| %>
          <% intensity = @alternative_thought.emotion_before_intensity(emotion) || 0 %>
          <div class="col-md-6 mb-3" data-controller="emotion-slider">
            <div class="emotion-slider-header">
              <label for="emotions_before_<%= emotion %>" class="form-label mb-0">
                <%= emotion.capitalize %>
              </label>
              <span class="badge <%= intensity > 0 ? 'bg-primary' : 'bg-secondary' %>"
                    data-emotion-slider-target="badge">
                <%= intensity %>
              </span>
            </div>
            <input type="range"
                   name="alternative_thought[emotions_before][<%= emotion %>]"
                   id="emotions_before_<%= emotion %>"
                   min="0" max="10"
                   value="<%= intensity %>"
                   class="form-range w-100"
                   autocomplete="off"
                   data-emotion-slider-target="slider"
                   data-action="input->emotion-slider#updateBadge">
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-secondary text-white py-2">
      <h5 class="mb-0">Exploring Thoughts</h5>
    </div>
    <div class="card-body">
      <p class="text-muted small mb-4">
        Use these exploring questions to examine your stuck point. Consider whether the thought is balanced and factual or extreme.
      </p>

      <div class="mb-4">
        <%= f.input :exploring_evidence_against,
            as: :text,
            label: "Evidence against?",
            input_html: { rows: 3, class: "form-control", placeholder: "What evidence contradicts this stuck point?" } %>
      </div>

      <div class="mb-4">
        <%= f.input :exploring_missing_info,
            as: :text,
            label: "What information is not included?",
            input_html: { rows: 3, class: "form-control", placeholder: "What relevant facts might you be overlooking?" } %>
      </div>

      <div class="mb-4">
        <%= f.input :exploring_all_or_none,
            as: :text,
            label: "All or none? Extreme?",
            input_html: { rows: 3, class: "form-control", placeholder: "Does this thought use absolute terms like 'always', 'never', 'everyone'?" } %>
      </div>

      <div class="mb-4">
        <%= f.input :exploring_focused_one_piece,
            as: :text,
            label: "Focused on just one piece of the event?",
            input_html: { rows: 3, class: "form-control", placeholder: "Are you only seeing part of what happened?" } %>
      </div>

      <div class="mb-4">
        <%= f.input :exploring_questionable_source,
            as: :text,
            label: "Questionable source of information?",
            input_html: { rows: 3, class: "form-control", placeholder: "Where did this belief come from? Is that source reliable?" } %>
      </div>

      <div class="mb-4">
        <%= f.input :exploring_confusing_probability,
            as: :text,
            label: "Confusing possible with unlikely?",
            input_html: { rows: 3, class: "form-control", placeholder: "Just because something is possible, does that make it likely?" } %>
      </div>

      <div class="mb-4">
        <%= f.input :exploring_feelings_or_facts,
            as: :text,
            label: "Based on feelings or facts?",
            input_html: { rows: 3, class: "form-control", placeholder: "Is this belief based on emotions or objective evidence?" } %>
      </div>
    </div>
  </div>

  <%= render "shared/form_actions", f: f, cancel_path: @alternative_thought %>
<% end %>
