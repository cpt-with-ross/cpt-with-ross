<%= simple_form_for [@index_event, @baseline],
    url: index_event_baseline_path(@index_event, section: 'pcl'),
    data: { turbo_frame: "main_content", controller: "pcl-score", action: "change->pcl-score#calculate" } do |f| %>
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0">PTSD Symptom Checklist (PCL-5)</h5>
    </div>
    <div class="card-body">
      <p class="text-muted mb-4">
        <em>Instructions:</em> Below is a list of problems that people sometimes have in response to a very stressful experience.
        Please read each problem carefully, and then select one of the options to indicate how much you have been bothered
        by that problem <strong>in the past month</strong>.
      </p>

      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th style="width: 50%">In the past month, how much were you bothered by:</th>
              <% Baseline::PCL_SCALE.each do |score, label| %>
                <th class="text-center" style="width: 10%"><small><%= label %><br>(<%= score %>)</small></th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% Baseline::PCL_QUESTIONS.each_with_index do |(attr, question), index| %>
              <% current_value = @baseline.send(attr) %>
              <tr>
                <td><%= index + 1 %>. <%= question %></td>
                <% Baseline::PCL_SCALE.each do |score, _label| %>
                  <td class="text-center">
                    <%= f.radio_button attr, score, class: "form-check-input", checked: (current_value.nil? ? score == 0 : current_value == score) %>
                  </td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="mt-3 mb-4">
        <strong>Total Score:</strong>
        <span data-pcl-score-target="total"><%= @baseline.pcl_total_score %></span> / 80
        <small class="text-muted">(The possible range of scores is 0-80)</small>
      </div>

      <div class="d-flex gap-2">
        <%= f.button :submit, "Save", class: "btn btn-primary" %>
        <%= link_to "Cancel", index_event_baseline_path(@index_event), class: "btn btn-outline-secondary", data: { turbo_frame: "main_content" } %>
      </div>
    </div>
  </div>
<% end %>
