<p style="color: green"><%= notice %></p>

<h1>Assistant for: <%= @challenge.title %></h1>

<p>
  Using <strong><%= @chat.model&.name || "Standard AI" %>
</strong></p>

<% content_for :title, "Chat: #{@challenge.title}" %>

<%= turbo_stream_from "chat_#{@chat.id}" %>

<div id="messages">
  <% @chat.messages.where(role: ["user", "assistant"]).where.not(id: nil).each do |message| %>
    <%= render message %>
  <% end %>
</div>

<% if @chat.messages.none? { |m| m.persisted? } %>
    <p class="text-muted">No messages yet. Ask a question to get started!</p>
<% end %>

<div style="margin-top: 30px;">
  <%= render "messages/form", chat: @chat, message: @message %>
</div>

<div style="margin-top: 20px;">
  <%= link_to "Back to challenge", challenge_path(@challenge), class: "btn btn-secondary" %>
</div>
